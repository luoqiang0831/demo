!function(t){function e(t,e){for(var a in e)"undefined"==typeof t[a]&&(t[a]=e[a]);return t}function a(){var e,a=cfg.imgData,n=currentIndex;e=n>=a.length-1?0:n+1,imgNum++,imgNum==parseInt(imgTotal+1)&&(imgNum=1);var i=t("#center"),s=t("#next");cfg.before.call(this,n,i),i.css("-webkit-transform","translate3d(-"+m+"px,0,0)").attr("pos","-"+m),t("#prev").remove(),i.attr("id","prev"),s.css("-webkit-transform","translate3d(0,0,0)").attr("pos","0").attr("id","center"),currentIndex=e;var r=t("<div class='imgItem loading' id='next' pos="+m+" style='-webkit-transform:translate3d("+m+"px,0,0);'></div>");r.html(e+1>a.length-1?'<img  src="'+a[0]+'" onload="javascript:this.parentNode.className=\'imgItem\';"  />':'<img  src="'+a[e+1]+'" onload="javascript:this.parentNode.className=\'imgItem\';"  />'),t("#ImgContainer").append(r),o(),c(),t("#box-num").html((imgNum+1>imgTotal?1:currentIndex+1)+" / "+imgTotal),cfg.after.call(this,e,t("#center"))}function n(){var e,a=cfg.imgData,n=currentIndex;e=0==n?a.length-1:n-1,imgNum--,0==imgNum&&(imgNum=imgTotal);var i=t("#center"),s=t("#prev");o(),cfg.before.call(this,e,i),i.css("-webkit-transform","translate3d("+m+"px,0,0)").attr("pos",m),t("#next").remove(),i.attr("id","next"),s.css("-webkit-transform","translate3d(0,0,0)").attr("pos","0").attr("id","center"),currentIndex=e;var r=t("<div class='imgItem loading' id='prev' pos=-"+m+" style='-webkit-transform:translate3d(-"+m+"px,0,0);'></div>");r.html(0>e-1?'<img  src="'+a[a.length-1]+'" onload="javascript:this.parentNode.className=\'imgItem\';" />':'<img  src="'+a[e-1]+'" onload="javascript:this.parentNode.className=\'imgItem\';"  />'),t("#ImgContainer").prepend(r),c(),t("#box-num").html((imgNum+1>imgTotal?1:currentIndex+1)+" / "+imgTotal),cfg.after.call(this,n,t("#center"))}function i(t,e){var a=e.pageX-t.pageX,n=e.pageY-t.pageY;return Math.sqrt(a*a+n*n)}function s(t,e){return t.length>=2&&e.length>=2?i(e[0],e[1])/i(t[0],t[1]):1}function o(){t("#center img,#prev img,#next img").attr("style","")}function r(){t("#center").css("-webkit-transform","translate3d(0,0, 0)"),t("#prev").css("-webkit-transform","translate3d(-"+m+"px,0, 0)").attr("pos",-m),t("#next").css("-webkit-transform","translate3d("+m+"px,0, 0)").attr("pos",m)}function c(){var e=t("#center>img"),i=0,o=1,c=cfg.maxScale,l=cfg.minScale,p=0,d=0,g=1;e.on("webkitTransitionEnd",function(){t(this).removeClass("view-img-zoom-animate")}),cfg.doubleZoom&&e.off("doubleTap").doubleTap(function(){1!=i&&1!=isSlip&&(i=1,e.addClass("view-img-zoom-animate"),o>1?(e.css({top:"0",left:"0","-webkit-transform":"scale(1,1)"}),o=i=g=1):(t(this).css({top:"0",left:"0","-webkit-transform":"scale("+c+","+c+")"}),o=g=c),p=0,d=0,setTimeout(function(){i=0},200))});var u=0,f=0,h=0,v=0,b={},x=parseInt(t("#center img").width()),w=parseInt(t("#center img").height()),I=t(window).width(),k=t(window).height();e.off("touchstart").on("touchstart",function(t){if(2==t.touches.length)b.touches=[{pageX:t.touches[0].pageX,pageY:t.touches[0].pageY},{pageX:t.touches[1].pageX,pageY:t.touches[1].pageY}],isSlip=1;else{if(1==isSlip)return;u=t.touches[0].pageX,f=t.touches[0].pageY}}),e.off("touchmove").on("touchmove",function(a){var n=parseInt($this.find("#next").attr("pos")),x=parseInt($this.find("#prev").attr("pos"));if(2==a.touches.length){var w=s(b.touches,a.touches);if(1!=w){if(isSlip=1,isMove=0,n>0&&m>n||0>x&&x>-m||1==i)return alert(x),void r();o=g*w,o>c?o=c:l>o&&(o=l),e.css({"-webkit-transform":"scale("+o+","+o+")"})}return!1}if(!(1==isSlip||1==o||n>0&&m>n||0>x&&x>-m||1==i)){isMove=1;var I=a.touches[0].pageX,k=a.touches[0].pageY;h=parseInt(p+k-f),v=parseInt(d+I-u),t(this).css({top:h+"px",left:v+"px"})}}),e.off("touchend").on("touchend",function(){if(1==isSlip){if(1==o){var s=parseInt($this.find("#next").attr("pos")),r=parseInt($this.find("#prev").attr("pos"));s>20&&m>s&&a(),-20>r&&r>-m&&n()}return 1.2>o&&(e.addClass("view-img-zoom-animate"),e.css({top:"0",left:"0"})),g=o,p=0,d=0,b={},void setTimeout(function(){isSlip=0},100)}if(1!=isSlip&&1!=o&&1!=i){if(p=h,d=v,d>(o*x-I)/2+.3*I)return o=1,isMove=0,void n();if(d>(o*x-I)/2&&(d=(o*x-I)/2),-(o*x-I)/2-.3*I>d)return o=1,isMove=0,void a();-(o*x-I)/2>d&&(d=-(o*x-I)/2);var c=!1;o*w>k?(p>(o*w-k)/2&&(p=(o*w-k)/2,c=!0),-(o*w-k)/2>p&&(p=-(o*w-k)/2,c=!0)):(p=0,c=!0),c&&t(this).addClass("view-img-zoom-animate"),t(this).css({top:p+"px",left:d+"px"}),setTimeout(function(){isMove=0},100)}})}var m=document.documentElement.clientWidth;document.documentElement.clientHeight,$this=null,currentIndex=0,imgNum=0,imgTotal=0,isMove=0,isSlip=0,cfg={},t.fn.ImgView=function(i){if(!(void 0==i.imgData||i.imgData.length<=0||"true"==t(this).attr("open"))){var s={imgData:null,doubleZoom:!1,zoom:!0,pageShow:!0,switchBtn:!1,minScale:1,maxScale:1,before:new Function,after:new Function};cfg=e(i||{},s);var o=cfg.imgData,l="",p=currentIndex;$this=t(this),$ImgContainer=t("<div id='ImgContainer' style='height:"+t(window).height()+"px'></div>");var d=p-1,g=p+1;imgTotal=o.length,0==p&&(d=o.length-1),l='<div id="prev" class="imgItem loading" pos="-'+m+'" style="-webkit-transform:translate3d(-'+m+'px,0,0);"><img  src="'+o[d]+'"  onload="javascript:this.parentNode.className=\'imgItem\';"  /></div>',l+='<div id="center" class="imgItem loading" pos="0" style="-webkit-transform:translate3d(0,0,0);"><img src="'+o[p]+'" onload="javascript:this.parentNode.className=\'imgItem\';"  /></div>',p==o.length-1&&(g=0),l+='<div id="next" class="imgItem loading" pos="'+m+'" style="-webkit-transform:translate3d('+m+'px,0,0);"><img src="'+o[g]+'"  onload="javascript:this.parentNode.className=\'imgItem\';" /></div>',$ImgContainer.html(l),$this.append('<div id="tools" style="-webkit-transition: all 0.2s ease-out;"><a href="javascript:void(0)" id="btn-back" class="btn-back"><em></em>返回</a><span id="box-num" style="display:'+(cfg.pageShow?"block":"none")+'">'+(0==currentIndex?"1":imgNum)+" / "+imgTotal+"</span></div>"),cfg.switchBtn&&$this.append('<div id="btn-prev" class="btn-dir no-delay" style="-webkit-transition: all 0.2s ease-out;"><span class="btn-bg span-prev"></span></div><div id="btn-next" class="btn-dir no-delay" style="-webkit-transition: all 0.2s ease-out;"><span class="btn-bg span-next"></span></div>'),$this.append($ImgContainer),$this.css("display","block").attr("open","true"),$this.on("touchmove",function(t){t.preventDefault()}).on("tap","#btn-back",function(){$this.css("display","none").attr("open","false").html("")}).on("click","#btn-prev",function(t){n(),t.stopPropagation()}).on("click","#btn-next",function(t){a(),t.stopPropagation()});var u=function(){var t=document.body;t.className="hide-bar"==t.className?"":"hide-bar"};setTimeout(function(){u(),t(document).off("click").on("click",u)},3e3),cfg.zoom&&c();var f=0,h=0,v=0,b=0,x=0,w=0,I=0,k=0,N=!!t("#prev"),C=!!t("#next");$this.on("touchstart","#ImgContainer",function(e){1!=isSlip&&(f=e.touches[0].pageX,h=f,v=0,b=-m,x=m,C&&t("#next").addClass("touchmove"),t("#center").addClass("touchmove"),N&&t("#prev").addClass("touchmove"))}),$this.on("touchmove","#ImgContainer",function(e){if(1!=isSlip&&1!=isMove&&1===e.touches.length){var a=e.touches[0].pageX;w=a-h,I=v+a-f;var n=I+"px,0";if(t("#center").css("-webkit-transform","translate3d("+n+", 0)"),v=I,0>I){if(C){scale=1,k=x+a-f;var i=k+"px,0";t("#next").attr("pos",k),t("#next").css("-webkit-transform","translate3d("+i+", 0)"),x=k}}else if(N){scale=1,k=b+a-f;var i=k+"px,0";t("#prev").attr("pos",k),t("#prev").css("-webkit-transform","translate3d("+i+", 0)"),b=k}return f=a,!1}}),$this.on("touchend","#ImgContainer",function(){-15>w?a():w>15?n():r(),I=0,w=0,N&&t("#prev").removeClass("touchmove"),t("#center").removeClass("touchmove"),C&&t("#next").removeClass("touchmove")})}}}(Zepto);